======================================================================================================================

I - Cilj i koncept projekta

Ovaj projekat predstavlja obradu zvucnog signala putem MFCC pipeline-a (Mel-Frequency Cepstral Coefficients).
Ideja je da se signal kroz MFCC obradu pretvori u kompaktniji opis (vektor koeficijenata) spreman za dalju analizu
(npr. klasifikaciju, klasterovanje, detekciju zvuka, itd.).

Implementacija je modularna: svaka faza obrade (prozoriranje, FFT, Mel, DCT) je odvojena, pa je jednostavno
pratiti i testirati svaku komponentu zasebno.

======================================================================================================================

II - Arhitektura projekta

Struktura projekta (najbitniji folderi):

1) include/

    a) include/core/
        - Strukture koje predstavljaju ulaz/izlaz DSP faza.
        - Frame<N> je ulazni frejm (N uzoraka), a Spectre<N> je izlaz FFT-a.
        - types.hpp sadrzi tipove/konstante potrebne u obradi.

    b) include/dsp/
        - Implementacije DSP koraka:
          - window.hpp (Hann/Hamming prozoriranje)
          - fft.hpp (FFT transformacija)
          - mel.hpp (Mel filterbank + normalizacija)
          - helpers.hpp (pomocne funkcije: power_spectrum, log_compression, dct, ...)
        - Napomena: logika je organizovana kroz klase i pomocne funkcije (nije striktno singleton pristup).

    c) include/features/
        - Visenivojski (feature) modul koji spaja korake u jedan pipeline.
        - MFCCPipeline<N> izvrsava:
          1) prozoriranje (Hann)
          2) FFT
          3) power spectrum
          4) Mel filterbank
          5) log kompresiju
          6) DCT (prema implementaciji u dsp/helpers)

2) tests/
    - Jednostavni izvrsni testovi koji provjeravaju ponasanje pojedinih komponenti:
      - fft_test: provjera FFT-a
      - window_test: provjera Hann/Hamming prozora
      - pipeline_test: provjera kompletnog MFCC pipeline-a nad razlicitim signalima (sinusni, zbirni sinusni, nula,
        impulsni, rampa, jednosmjerni i bijeli sum).

3) bindings/
    - Pybind11 bindingsi koji iz C++ dijela generisu Python modul reson.
    - Modul je organizovan u podmodule:
      - reson.core (Frame128/256/512/1024, Spectre...)
      - reson.dsp (Window..., FFT..., MelFilterBank, WindowType)
      - reson.features (MFCCPipeline128/256/512/1024)

4) build/
    - Out-of-source build direktorijum (generise ga CMake).

5) example.py
    - Primjer koriscenja Python modula: generise 440Hz sinus, pokrece MFCC pipeline i ispisuje koeficijente.

======================================================================================================================

III - Implementacija projekta

MFCC pipeline je implementiran kroz genericku klasu MFCCPipeline<N> (header-only), gdje N predstavlja velicinu
ulaznog frejma (npr. 128/256/512/1024). Pipeline radi nad jednom instancom frejma i vraca vektor MFCC
koeficijenata (std::vector<float>).

Tok obrade (konceptualno, po pozivu process(frame)):

1) Prozoriranje
    - Ulazni Frame<N> se mnozi prozorskom funkcijom (default Hann).
    - Prozor smanjuje "leakage" prije FFT-a.

2) FFT
    - Iz prozoriranog frejma se racuna Spectre<N> (kompleksni spektar).

3) Power spectrum
    - Iz kompleksnog spektra racuna se power spektar.
    - Tipicno se koristi samo pozitivni dio spektra (N/2 + 1 binova).

4) Mel filterbank
    - Power spektar se projektuje na Mel skalu preko trougaonih filtera.
    - Parametri: sample_rate, n_fft, n_mels, fmin_hz, fmax_hz.
    - Ako je fmax_hz = -1, postavlja se automatski na Nyquist frekvenciju (sample_rate/2).

5) Log kompresija
    - Na Mel energije se primjenjuje log(Â·) (log kompresija dinamike).

6) DCT
    - Na log-Mel energije se primjenjuje DCT i uzima se prvih n_mfcc koeficijenata.

Parametri koje korisnik kontrolise:
    - sample_rate: frekvencija odabiranja signala
    - n_mels: broj Mel filtera
    - n_fft: velicina FFT bafera (preporuka: n_fft == N)
    - n_mfcc: broj izlaznih MFCC koeficijenata
    - fmin_hz, fmax_hz: donja/gornja frekvencija (Hz)

Pretpostavke i ogranicenja (namjerno minimalisticki pipeline):
    - Pipeline radi nad jednim frejmom; ne radi automatski framing, overlap/hop, niti obradu cijelog signala.
    - Ne radi pre-emphasis, liftering, delta/delta-delta koeficijente.
    - Ako korisnik zeli MFCC nad cijelim signalom, potrebno je signal prvo podijeliti na frejmove (sa hop-om) 
      i pozvati process(frame) za svaki frejm.

======================================================================================================================

IV - Kako koristiti program?

1) Zavisnosti

Opcija A (automatski):
    - Pokrenuti skriptu setup.sh (instalira cmake, compiler toolchain, python3-dev i pybind11).

Opcija B (rucno):
    - Potrebno: CMake >= 3.20, C++17 compiler (g++/clang++), Python3 + python3-dev, pybind11.

2) Build (iz korijena projekta)

    mkdir -p build
    cd build
    cmake ..
    make -j

Rezultat build-a:
    - izvrsni fajlovi testova: fft_test, window_test, pipeline_test
    - Python modul: reson*.so (ime zavisi od verzije Python-a i platforme)

3) Pokretanje testova

    cd build
    ./fft_test
    ./window_test
    ./pipeline_test

4) Koriscenje iz Python-a

Najjednostavnije je pokrenuti example skriptu tako da Python vidi build/ direktorijum:
    - iz root foldera projekta: python3 example.py (skripta sama dodaje build/ u sys.path)
    - ili iz build direktorijuma: python3 ../example.py

Alternativa (rucno):
    - export PYTHONPATH="$PWD/build:$PYTHONPATH"
    - python3 example.py

5) Kratki API pregled (Python)

    - Frejm (npr. 512 uzoraka):
            frame = reson.core.Frame512()
            frame[i] = ...

    - Pipeline:
            mfcc = reson.features.MFCCPipeline512(
                    sample_rate=16000,
                    n_mels=40,
                    n_fft=512,
                    n_mfcc=13,
                    fmin_hz=0,
                    fmax_hz=-1
            )
            coeffs = mfcc.process(frame)

Napomene:
    - Preporuka je da n_fft odgovara velicini frejma (npr. Frame512 sa n_fft=512), jer FFT se racuna na N uzoraka.
    - fmax_hz=-1 znaci da se automatski postavlja na Nyquist frekvenciju (sample_rate/2).

======================================================================================================================
